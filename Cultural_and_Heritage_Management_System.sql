--create table HERITAGE_SITE

CREATE TABLE HERITAGE_SITE (
    SITE_ID NUMBER PRIMARY KEY,
    SITE_NAME VARCHAR2(100) NOT NULL,
    LOCATION VARCHAR2(100),
    ESTABLISHED_YEAR NUMBER,
    DESCRIPTION VARCHAR2(500)
);

--create table ARTIFACT

CREATE TABLE ARTIFACT (
    ARTIFACT_ID NUMBER PRIMARY KEY,
    NAME VARCHAR2(100),
    MATERIAL VARCHAR2(50),
    ORIGIN_DATE DATE,
    SITE_ID NUMBER,
    FOREIGN KEY (SITE_ID) REFERENCES HERITAGE_SITE(SITE_ID)
);

--create table RESTORATION_PROJECT

CREATE TABLE RESTORATION_PROJECT (
    PROJECT_ID NUMBER PRIMARY KEY,
    SITE_ID NUMBER,
    START_DATE DATE,
    END_DATE DATE,
    COST NUMBER,
    STATUS VARCHAR2(50),
    FOREIGN KEY (SITE_ID) REFERENCES HERITAGE_SITE(SITE_ID)
);

--create table VISITOR

CREATE TABLE VISITOR (
    VISITOR_ID NUMBER PRIMARY KEY,
    VISIT_DATE DATE,
    SITE_ID NUMBER,
    REVENUE NUMBER,
    FOREIGN KEY (SITE_ID) REFERENCES HERITAGE_SITE(SITE_ID)
);

--insert data into HERITAGE_SITE table

INSERT INTO HERITAGE_SITE VALUES (1, 'Taj Mahal', 'Agra', 1632, 'Symbol of love');
INSERT INTO HERITAGE_SITE VALUES (2, 'Qutub Minar', 'Delhi', 1193, 'Historical monument');
INSERT INTO HERITAGE_SITE VALUES (3, 'Red Fort', 'Delhi', 1648, 'Historic fort in the city of Delhi');
INSERT INTO HERITAGE_SITE VALUES (4, 'Hampi', 'Karnataka', 1336, 'Ancient village with ruins of temples and palaces');
INSERT INTO HERITAGE_SITE VALUES (5, 'Ajanta Caves', 'Maharashtra', 200, 'Rock-cut caves with ancient Buddhist paintings and sculptures');
INSERT INTO HERITAGE_SITE VALUES (6, 'Charminar', 'Hyderabad', 1591, 'Famous Islamic architecture and monument in Hyderabad.');
INSERT INTO HERITAGE_SITE VALUES (7, 'Meenakshi Temple', 'Madurai', 1623, 'Historic Hindu temple dedicated to Goddess Meenakshi.');
INSERT INTO HERITAGE_SITE VALUES (8, 'Kaziranga National Park', 'Assam', 1905, 'World Heritage Site known for one-horned rhinos.');
INSERT INTO HERITAGE_SITE VALUES (9, 'Nalanda University', 'Bihar', 450, 'Ancient center of higher learning in India.');
INSERT INTO HERITAGE_SITE VALUES (10, 'Konark Sun Temple', 'Odisha', 1250, 'Famous 13th-century sun temple and a UNESCO World Heritage Site.');
INSERT INTO HERITAGE_SITE VALUES (12, 'Gateway of India', 'Mumbai', 1924, 'Iconic arch-monument built during the British rule in India.');

--insert data into ARTIFACT table

INSERT INTO ARTIFACT VALUES (101, 'Ivory Sculpture', 'Ivory', TO_DATE('1800-01-01', 'YYYY-MM-DD'), 1);
INSERT INTO ARTIFACT VALUES (102, 'Ancient Manuscript', 'Paper', TO_DATE('1500-01-01', 'YYYY-MM-DD'), 2);
INSERT INTO ARTIFACT VALUES (103, 'Bronze Statue', 'Bronze', TO_DATE('1200-01-01', 'YYYY-MM-DD'), 3);
INSERT INTO ARTIFACT VALUES (104, 'Terracotta Figurine', 'Terracotta', TO_DATE('1500-01-01', 'YYYY-MM-DD'), 4);
INSERT INTO ARTIFACT VALUES (105, 'Stone Carving', 'Stone', TO_DATE('0200-01-01', 'YYYY-MM-DD'), 5);
INSERT INTO ARTIFACT VALUES (106, 'Golden Crown', 'Gold', TO_DATE('1700-01-01', 'YYYY-MM-DD'), 7);
INSERT INTO ARTIFACT VALUES (107, 'Temple Carving', 'Granite', TO_DATE('1600-01-01', 'YYYY-MM-DD'), 8);
INSERT INTO ARTIFACT VALUES (108, 'Rhino Fossil', 'Bone', TO_DATE('1800-01-01', 'YYYY-MM-DD'), 9);
INSERT INTO ARTIFACT VALUES (109, 'Ancient Scroll', 'Paper', TO_DATE('400-01-01', 'YYYY-MM-DD'), 10);
INSERT INTO ARTIFACT VALUES (110, 'Silver Coins', 'Silver', TO_DATE('1400-01-01', 'YYYY-MM-DD'), 7);
INSERT INTO ARTIFACT VALUES (112, 'Bronze Cannon', 'Bronze', TO_DATE('1800-01-01', 'YYYY-MM-DD'), 12);

--insert data into RESTORATION_PROJECT table

INSERT INTO RESTORATION_PROJECT VALUES (201, 1, TO_DATE('2023-01-01', 'YYYY-MM-DD'), TO_DATE('2023-12-31', 'YYYY-MM-DD'), 500000, 'In Progress');
INSERT INTO RESTORATION_PROJECT VALUES (202, 2, TO_DATE('2024-01-01', 'YYYY-MM-DD'), NULL, 300000, 'Pending');
INSERT INTO RESTORATION_PROJECT VALUES (203, 3, TO_DATE('2024-02-01', 'YYYY-MM-DD'), TO_DATE('2024-12-31', 'YYYY-MM-DD'), 700000, 'In Progress');
INSERT INTO RESTORATION_PROJECT VALUES (204, 4, TO_DATE('2025-01-01', 'YYYY-MM-DD'), NULL, 400000, 'Pending');
INSERT INTO RESTORATION_PROJECT VALUES (205, 5, TO_DATE('2025-03-01', 'YYYY-MM-DD'), TO_DATE('2025-12-31', 'YYYY-MM-DD'), 600000, 'In Progress');
INSERT INTO RESTORATION_PROJECT VALUES (206, 7, TO_DATE('2023-11-01', 'YYYY-MM-DD'), TO_DATE('2024-10-31', 'YYYY-MM-DD'), 450000, 'In Progress');
INSERT INTO RESTORATION_PROJECT VALUES (207, 8, TO_DATE('2024-02-01', 'YYYY-MM-DD'), NULL, 500000, 'Pending');
INSERT INTO RESTORATION_PROJECT VALUES (208, 9, TO_DATE('2025-03-01', 'YYYY-MM-DD'), TO_DATE('2026-03-01', 'YYYY-MM-DD'), 750000, 'In Progress');
INSERT INTO RESTORATION_PROJECT VALUES (209, 10, TO_DATE('2023-10-01', 'YYYY-MM-DD'), NULL, 750000, 'Pending');
INSERT INTO RESTORATION_PROJECT VALUES (210, 6, TO_DATE('2024-05-15', 'YYYY-MM-DD'), NULL, 650000, 'Pending');
INSERT INTO RESTORATION_PROJECT VALUES (211, 12, TO_DATE('2024-07-01', 'YYYY-MM-DD'), NULL, 600000, 'Pending');

--insert data into VISITOR table

INSERT INTO VISITOR VALUES (301, TO_DATE('2024-01-01', 'YYYY-MM-DD'), 1, 100);
INSERT INTO VISITOR VALUES (302, TO_DATE('2024-01-02', 'YYYY-MM-DD'), 2, 50);
INSERT INTO VISITOR VALUES (303, TO_DATE('2024-01-03', 'YYYY-MM-DD'), 3, 150);
INSERT INTO VISITOR VALUES (304, TO_DATE('2024-01-04', 'YYYY-MM-DD'), 4, 200);
INSERT INTO VISITOR VALUES (305, TO_DATE('2024-01-05', 'YYYY-MM-DD'), 5, 250);
INSERT INTO VISITOR VALUES (306, TO_DATE('2024-01-12', 'YYYY-MM-DD'), 3, 150);
INSERT INTO VISITOR VALUES (307, TO_DATE('2024-02-10', 'YYYY-MM-DD'), 4, 200);
INSERT INTO VISITOR VALUES (308, TO_DATE('2024-02-17', 'YYYY-MM-DD'), 5, 250);
INSERT INTO VISITOR VALUES (309, TO_DATE('2024-02-22', 'YYYY-MM-DD'), 3, 150);
INSERT INTO VISITOR VALUES (310, TO_DATE('2024-03-01', 'YYYY-MM-DD'), 7, 300);
INSERT INTO VISITOR VALUES (311, TO_DATE('2024-04-05', 'YYYY-MM-DD'), 8, 250);
INSERT INTO VISITOR VALUES (312, TO_DATE('2024-05-10', 'YYYY-MM-DD'), 9, 400);
INSERT INTO VISITOR VALUES (313, TO_DATE('2024-06-15', 'YYYY-MM-DD'), 2, 50);
INSERT INTO VISITOR VALUES (314, TO_DATE('2024-03-20', 'YYYY-MM-DD'), 7, 350);
INSERT INTO VISITOR VALUES (315, TO_DATE('2024-12-25', 'YYYY-MM-DD'), 8, 180);
INSERT INTO VISITOR VALUES (316, TO_DATE('2024-03-30', 'YYYY-MM-DD'), 9, 500);
INSERT INTO VISITOR VALUES (317, TO_DATE('2024-04-05', 'YYYY-MM-DD'), 10, 220);
INSERT INTO VISITOR VALUES (318, TO_DATE('2024-07-15', 'YYYY-MM-DD'), 12, 180);
INSERT INTO VISITOR VALUES (319, TO_DATE('2024-10-24', 'YYYY-MM-DD'), 12, 500);
INSERT INTO VISITOR VALUES (320, TO_DATE('2024-11-25', 'YYYY-MM-DD'), 12, 180);
INSERT INTO VISITOR VALUES (321, TO_DATE('2024-03-11', 'YYYY-MM-DD'), 9, 500);


SELECT * FROM HERITAGE_SITE;
SELECT * FROM ARTIFACT;
SELECT * FROM RESTORATION_PROJECT;
SELECT * FROM VISITOR;

--create table HERITAGE_SITE_LOG

CREATE TABLE HERITAGE_SITE_LOG (
    LOG_ID NUMBER PRIMARY KEY,
    SITE_ID NUMBER,
    UPDATE_DATE DATE,
    ACTION_TYPE VARCHAR2(50),
    OLD_DESCRIPTION VARCHAR2(500),
    NEW_DESCRIPTION VARCHAR2(500)
);

 --Sequence and Trigger for logging heritage site updates

CREATE SEQUENCE SEQ_HERITAGE_SITE_LOG
START WITH 1
INCREMENT BY 1
NOCACHE;

-- Trigger to log changes in heritage site descriptions

CREATE OR REPLACE TRIGGER LOG_HERITAGE_SITE_UPDATES
AFTER UPDATE OF DESCRIPTION ON HERITAGE_SITE
FOR EACH ROW
BEGIN
    INSERT INTO HERITAGE_SITE_LOG (
        LOG_ID, SITE_ID, UPDATE_DATE, ACTION_TYPE, OLD_DESCRIPTION, NEW_DESCRIPTION
    )
    VALUES (
        SEQ_HERITAGE_SITE_LOG.NEXTVAL, :OLD.SITE_ID, SYSDATE, 'Update',
        :OLD.DESCRIPTION, :NEW.DESCRIPTION
    );
END;

-- Trigger to raise an alert when a restoration project is delayed

CREATE OR REPLACE TRIGGER ALERT_RESTORATION_DELAY
BEFORE UPDATE OF STATUS ON RESTORATION_PROJECT
FOR EACH ROW
WHEN (NEW.STATUS = 'Delayed')
BEGIN
    DBMS_OUTPUT.PUT_LINE('Alert: Restoration project ' || :NEW.PROJECT_ID || ' is delayed.');
END;

-- Procedure to track visitor numbers for a specific site

CREATE OR REPLACE PROCEDURE TRACK_VISITOR_NUMBERS (
    p_site_id IN NUMBER,
    p_visitor_count OUT NUMBER
) AS
BEGIN
    SELECT COUNT(*)
    INTO p_visitor_count
    FROM VISITOR
    WHERE SITE_ID = p_site_id;
END;

-- Function to calculate total revenue for a specific site

CREATE OR REPLACE FUNCTION CALCULATE_REVENUE (
    p_site_id IN NUMBER
) RETURN NUMBER AS
    total_revenue NUMBER;
BEGIN
    SELECT SUM(REVENUE)
    INTO total_revenue
    FROM VISITOR
    WHERE SITE_ID = p_site_id;
    RETURN total_revenue;
END;



CREATE OR REPLACE FUNCTION CALCULATE_PROJECT_COST (
    p_project_id IN NUMBER
) RETURN NUMBER AS
    project_cost NUMBER;
BEGIN
    SELECT COST
    INTO project_cost
    FROM RESTORATION_PROJECT
    WHERE PROJECT_ID = p_project_id;
    RETURN project_cost;
END;

-- Procedure to generate a report of popular sites based on visitor count

CREATE OR REPLACE PROCEDURE POPULAR_SITES_REPORT AS
BEGIN
    FOR rec IN (SELECT SITE_ID, COUNT(*) AS VISITORS
                FROM VISITOR
                GROUP BY SITE_ID
                ORDER BY VISITORS DESC) LOOP
        DBMS_OUTPUT.PUT_LINE('Site ID: ' || rec.SITE_ID || ' - Visitors: ' || rec.VISITORS);
    END LOOP;
END;

-- Procedure to alert for delayed restoration projects

CREATE OR REPLACE PROCEDURE DELAYED_PROJECTS_ALERT AS
BEGIN
    FOR rec IN (SELECT PROJECT_ID, SITE_ID, STATUS
                FROM RESTORATION_PROJECT
                WHERE STATUS = 'Delayed') LOOP
        DBMS_OUTPUT.PUT_LINE('Project ID: ' || rec.PROJECT_ID || ' at Site ID: ' || rec.SITE_ID || ' is delayed.');
    END LOOP;
END;

-- Anonymous block to test visitor tracking

DECLARE
    visitor_count NUMBER;
BEGIN
    TRACK_VISITOR_NUMBERS(3, visitor_count);
    DBMS_OUTPUT.PUT_LINE('Visitor Count: ' || visitor_count);
END;


-- Anonymous block to test revenue calculation

BEGIN
    DBMS_OUTPUT.PUT_LINE('Total Revenue: ' || CALCULATE_REVENUE(5));
END;


-- Anonymous block to test popular sites and delayed projects alerts

BEGIN
    POPULAR_SITES_REPORT;
    DELAYED_PROJECTS_ALERT;
END;





